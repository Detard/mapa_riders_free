<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Riders Free</title>
    <link rel="icon" href="icones/icones_menu/riders_free_flavicon.png" type="image/png">
    <link rel="stylesheet" href="css/layout.css">
</head>
<body>

    <header class="topbar">
        <div class="topbar-left">
            <button id="menu-toggle" class="btn-menu">
                <img src="icones/icones_menu/legenda.svg" alt="Menu">
            </button>
        </div>
        <div class="topbar-right">
            <img src="icones/icones_menu/riders_free.png" alt="Riders Free" class="logo-estado">
        </div>
    </header>

    <div class="main-container">
        
        <div id="sidebar-container" class="sidebar-container closed">
            <button id="btn-close-sidebar-mobile" class="btn-close-mobile">√ó</button>

            <aside class="icon-bar">
                <div class="icon-item active" data-target="panel-locais" title="Locais">
                    <img src="icones/icones_menu/helmet.png" alt="Locais">
                </div>
                <div class="icon-item" data-target="panel-legendas" title="Legendas">
                    <img src="icones/icones_menu/legendas.png" alt="Legendas">
                </div>
                <div class="icon-item" data-target="panel-adicionar" title="Gest√£o">
                    <img src="icones/icones_menu/cloud-computing.png" alt="Gest√£o">
                </div>
                <div class="icon-item" data-target="panel-sobre" title="Sobre">
                    <img src="icones/icones_menu/informacao.png" alt="Sobre">
                </div>
            </aside>

            <div class="content-panel">
                
                <div id="panel-locais" class="panel-section active">
                    <h3>Detalhes do Local</h3>
                    <div id="conteudo-detalhes">
                        <p class="placeholder-text">Selecione um ponto no mapa para ver detalhes.</p>
                    </div>
                </div>

                <div id="panel-legendas" class="panel-section">
                    <h3>Categorias</h3>
                    <div class="legenda-grupo">
                        <h4>TURISMO & ROTAS</h4>
                        <div class="legenda-item"><img src="icones/icones_camadas/riders_free.svg"><span>Viagens do Grupo</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/hotel.svg"><span>Hotel / Pousada</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/cachoerias.svg"><span>Cachoeiras</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/barragem.svg"><span>Barragens</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/praia.svg"><span>Praias</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/parque.svg"><span>Balne√°rios</span></div> <div class="legenda-item"><img src="icones/icones_camadas/serra_da_capivara.svg"><span>Serra da Capivara</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/delta_do_rio_parnaiba.svg"><span>Delta do Parna√≠ba</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/museu.svg"><span>Museus</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/bens_tombados.svg"><span>Bens Tombados</span></div>
                        <div class="legenda-item"><img src="icones/icones_camadas/outros_locais.svg"><span>Outros Locais</span></div> </div>
                </div>

                <div id="panel-adicionar" class="panel-section">
                    <h3>Gest√£o de Dados</h3>
                    <p style="font-size: 13px; color: #666; margin-bottom: 20px;">√Årea administrativa.</p>
                    
                    <div id="auth-buttons-container">
                        <div class="auth-wrapper" id="wrapper-viagens">
                            <button class="btn-auth" onclick="iniciarAuth('viagens')">
                                <span>Atualizar Viagens Realizadas</span>
                                <img src="icones/icones_menu/padlock.png" class="padlock-icon">
                            </button>
                            <div class="password-container" style="display: none;">
                                <input type="password" id="pass-viagens" class="input-pass" placeholder="Senha..." onkeyup="verificarEnter(event, 'viagens')">
                                <button class="btn-ok" onclick="validarSenha('viagens')">‚Üí</button>
                            </div>
                        </div>
                        <div style="height: 15px;"></div>
                        <div class="auth-wrapper" id="wrapper-lugares">
                            <button class="btn-auth" onclick="iniciarAuth('lugares')">
                                <span>Atualizar Pontos Tur√≠sticos</span>
                                <img src="icones/icones_menu/padlock.png" class="padlock-icon">
                            </button>
                            <div class="password-container" style="display: none;">
                                <input type="password" id="pass-lugares" class="input-pass" placeholder="Senha..." onkeyup="verificarEnter(event, 'lugares')">
                                <button class="btn-ok" onclick="validarSenha('lugares')">‚Üí</button>
                            </div>
                        </div>
                    </div>

                    <div id="form-admin-container" style="display: none;">
                        <div class="form-header-admin">
                            <h4 id="titulo-modo">Editando...</h4>
                            <button onclick="sairModoAdmin()" class="btn-sair">Voltar</button>
                        </div>

                        <form id="form-dados" onsubmit="event.preventDefault(); salvarDados();">
                            <div class="filter-group highlight-group">
                                <label>O que voc√™ deseja fazer?</label>
                                <select id="seletor-edicao" class="input-padrao" onchange="mudarModoEdicao()">
                                    <option value="novo">‚ûï Adicionar Novo Local</option>
                                    <optgroup label="-- Editar Existente --" id="lista-locais-existentes"></optgroup>
                                </select>
                            </div>

                            <input type="hidden" id="admin-tipo-atual">

                            <div class="filter-group">
                                <label>Nome do Lugar</label>
                                <input type="text" id="campo-Nome do Lugar" class="input-padrao" required>
                            </div>

                            <div style="display: flex; gap: 10px;">
                                <div class="filter-group" style="flex: 1;">
                                    <label>Cidade</label>
                                    <input type="text" id="campo-Cidade" class="input-padrao">
                                </div>
                                <div class="filter-group" style="width: 60px;">
                                    <label>UF</label>
                                    <input type="text" id="campo-UF" class="input-padrao" value="PI">
                                </div>
                            </div>

                            <div class="filter-group">
                                <label>Classifica√ß√£o</label>
                                <select id="campo-Classifica√ß√£o" class="input-padrao" required>
                                    <option value="">Selecione...</option>
                                    <option value="Viagem Realizada" class="opt-viagem">Viagem Realizada</option>
                                    <option value="Hotel">Hotel / Pousada</option>
                                    <option value="Cachoeira">Cachoeira</option>
                                    <option value="Barragem">Barragem</option>
                                    <option value="Museu">Museu</option>
                                    <option value="Parque">Parque/Ecoturismo</option>
                                    <option value="Praia">Praia</option>
                                    <option value="Ponto Encontro">Ponto de Encontro</option>
                                </select>
                            </div>

                            <div class="filter-group highlight-group">
                                <label>Coordenadas</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="text" id="campo-Latitude" class="input-padrao" placeholder="-0.000000">
                                    <input type="text" id="campo-Longitude" class="input-padrao" placeholder="-0.000000">
                                </div>
                            </div>

                            <div class="filter-group">
                                <label>Detalhes da Visita</label>
                                <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                    <input type="text" id="campo-Distacia da Trilha" class="input-padrao" placeholder="Dist. Trilha">
                                    <select id="campo-N√≠vel da Trilha" class="input-padrao">
                                        <option value="">N√≠vel Trilha...</option>
                                        <option value="F√°cil">F√°cil</option>
                                        <option value="M√©dio">M√©dio</option>
                                        <option value="Dif√≠cil">Dif√≠cil</option>
                                    </select>
                                </div>
                                <input type="text" id="campo-√âpoca do Ano com √Ågua" class="input-padrao" placeholder="√âpoca com √Ågua">
                            </div>

                            <div class="filter-group">
                                <label>Custos</label>
                                <div style="display: flex; gap: 5px;">
                                    <select id="campo-Entrada" class="input-padrao">
                                        <option value="">Tipo Entrada...</option>
                                        <option value="Livre">Livre</option>
                                        <option value="Paga">Paga</option>
                                    </select>
                                    <input type="text" id="campo-Valor da Entrada" class="input-padrao" placeholder="Valor (R$)">
                                </div>
                            </div>

                            <div id="campos-viagem-extra" style="border-top: 1px dashed #ccc; padding-top: 10px; margin-top: 10px;">
                                <label style="color:#0352AA;">Detalhes da Viagem</label>
                                <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                    <input type="text" id="campo-Data da Viagem/Bate e Volta" class="input-padrao" placeholder="Data">
                                    <input type="text" id="campo-Quilometragem Total (ida e volta)" class="input-padrao" placeholder="KM Total">
                                </div>
                                <textarea id="campo-Descri√ß√£o Sobre a Viagem" class="input-padrao" rows="2" placeholder="Sobre a viagem..."></textarea>
                                <textarea id="campo-Descri√ß√£o da Estrada" class="input-padrao" rows="2" placeholder="Condi√ß√µes da estrada..."></textarea>
                            </div>

                            <div class="filter-group" style="margin-top: 15px;">
                                <label>Links e Imagens</label>
                                
                                <input type="text" id="campo-Link Google Maps" class="input-padrao" placeholder="Link Google Maps">
                                
                                <label style="font-size:11px; color:#666; margin-top:10px; display:block;">Fotos (Separe links diretos por v√≠rgula para criar Carrossel, ou cole link da pasta)</label>
                                <textarea id="campo-Link Fotos Drive" class="input-padrao" rows="3" placeholder="Ex: https://site.com/foto1.jpg, https://site.com/foto2.jpg"></textarea>
                                
                                <input type="text" id="campo-Rede Social do Local" class="input-padrao" placeholder="Link do Instagram ou Facebook" style="margin-top:5px;">
                            </div>

                            <div class="filter-actions">
                                <button type="submit" class="btn-aplicar">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="panel-sobre" class="panel-section">
                    <h3>Riders Free Map</h3>
                    <p>O <strong>Mapa Riders Free</strong> √© a ferramenta oficial do grupo para registrar nossas viagens, planejar novos destinos e mapear as belezas naturais do Piau√≠ e arredores.</p>
                    
                    <h4 style="margin-top: 20px; color: #333;">Funcionalidades:</h4>
                    <ul class="lista-sobre">
                        <li><strong>üó∫Ô∏è Rotas:</strong> Hist√≥rico visual de onde o grupo j√° passou.</li>
                        <li><strong>üìç Pontos:</strong> Cachoeiras, barragens e locais para turismo.</li>
                        <li><strong>üèçÔ∏è Planejamento:</strong> Ferramenta para sugerir novos "rol√™s".</li>
                    </ul>

                    <div class="dev-footer">
                        <p>Desenvolvido por:</p>
                        <strong>Lucas Mendes</strong>
                        <a href="https://wa.me/5586995520586" target="_blank" class="btn-whatsapp" title="Fale comigo no WhatsApp"></a>
                    </div>
                </div>

            </div>
        </div>

        <div id="mobile-overlay" class="mobile-overlay"></div>

        <div class="map-wrapper">
            <iframe src="mapa_riders_free.html" frameborder="0" id="map-frame"></iframe>
            
            <div class="layer-switcher">
                <button id="btn-mapa" class="layer-btn active" onclick="mudarBase('mapa')">Mapa</button>
                <button id="btn-satelite" class="layer-btn" onclick="mudarBase('satelite')">Sat√©lite</button>
            </div>

            <div id="layer-menu" class="layer-control-container minimized">
                
                <div class="layer-control-header" onclick="toggleLayerMenu()">
                    <span>Camadas</span>
                    <span class="toggle-icon">‚ñº</span>
                </div>

                <div class="layer-control-content">
                    
                    <div class="layer-group-title" style="margin-top:0;">Viagens</div>
                    <label class="layer-option">
                        <input type="checkbox" id="check-viagens" checked onchange="toggleLayer('Viagem Realizada', this.checked)">
                        Viagens do Grupo
                    </label>

                    <div class="layer-group-title">Hospedagem</div>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Hotel', this.checked)">
                        Hot√©is / Pousadas
                    </label>

                    <div class="layer-group-title">Natureza & Turismo</div>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Balne√°rio', this.checked)">
                        Balne√°rios
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Cachoeira', this.checked)">
                        Cachoeiras
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Barragem', this.checked)">
                        Barragens
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Praia', this.checked)">
                        Praias
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Delta', this.checked)">
                        Delta do Parna√≠ba
                    </label>

                    <div class="layer-group-title">Cultura & Hist√≥ria</div>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Museu', this.checked)">
                        Museus
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Bem Tombado', this.checked)">
                        Bens Tombados
                    </label>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Serra da Capivara', this.checked)">
                        Serra da Capivara
                    </label>

                    <div class="layer-group-title">Geral</div>
                    <label class="layer-option">
                        <input type="checkbox" onchange="toggleLayer('Outros', this.checked)">
                        Outros Locais
                    </label>
                </div>
            </div>
    </div>

    <script>
        const toggleBtn = document.getElementById('menu-toggle');
        const closeBtnMobile = document.getElementById('btn-close-sidebar-mobile');
        const sidebarContainer = document.getElementById('sidebar-container');
        const mobileOverlay = document.getElementById('mobile-overlay');
        const iconItems = document.querySelectorAll('.icon-item');
        const panels = document.querySelectorAll('.panel-section');

        function toggleSidebar() { sidebarContainer.classList.toggle('closed'); }
        function closeSidebar() { sidebarContainer.classList.add('closed'); }

        toggleBtn.addEventListener('click', toggleSidebar);
        mobileOverlay.addEventListener('click', closeSidebar);
        if(closeBtnMobile) closeBtnMobile.addEventListener('click', closeSidebar);

        iconItems.forEach(item => {
            item.addEventListener('click', () => {
                iconItems.forEach(i => i.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                item.classList.add('active');
                const targetId = item.getAttribute('data-target');
                document.getElementById(targetId).classList.add('active');
                if(sidebarContainer.classList.contains('closed')) sidebarContainer.classList.remove('closed');
            });
        });

        function mudarBase(tipo) {
            document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + tipo).classList.add('active');
            const iframe = document.getElementById('map-frame');
            if (iframe && iframe.contentWindow && iframe.contentWindow.trocarCamadaBase) {
                iframe.contentWindow.trocarCamadaBase(tipo);
            }
        }

        function toggleLayer(tipo, checked) {
            const iframe = document.getElementById('map-frame');
            if (iframe && iframe.contentWindow && iframe.contentWindow.toggleLayer) {
                iframe.contentWindow.toggleLayer(tipo, checked);
            }
        }

        const SENHA_MESTRA = "123";
        function iniciarAuth(tipo) {
            document.querySelector(`#wrapper-${tipo} .btn-auth`).style.display = 'none';
            document.querySelector(`#wrapper-${tipo} .password-container`).style.display = 'flex';
            document.getElementById(`pass-${tipo}`).focus();
        }
        function verificarEnter(event, tipo) { if (event.key === "Enter") validarSenha(tipo); }
        function validarSenha(tipo) {
            const input = document.getElementById(`pass-${tipo}`);
            if (input.value === SENHA_MESTRA) {
                input.value = '';
                abrirPainelAdmin(tipo);
            } else {
                input.style.borderColor = 'red';
                setTimeout(() => input.style.borderColor = '#ccc', 500);
            }
        }
        
        function abrirPainelAdmin(tipo) {
            document.getElementById('auth-buttons-container').style.display = 'none';
            document.getElementById('form-admin-container').style.display = 'block';
            document.getElementById('admin-tipo-atual').value = tipo;
            document.getElementById('titulo-modo').innerText = tipo === 'viagens' ? 'Gerenciar Viagens' : 'Gerenciar Locais';
            
            const optViagem = document.querySelector('.opt-viagem');
            if(tipo === 'lugares') {
                optViagem.style.display = 'none';
                document.getElementById('campos-viagem-extra').style.display = 'none';
            } else {
                optViagem.style.display = 'block';
                document.getElementById('campos-viagem-extra').style.display = 'block';
            }

            const iframe = document.getElementById('map-frame');
            if(iframe && iframe.contentWindow.obterDadosParaEdicao) {
                const lista = iframe.contentWindow.obterDadosParaEdicao(tipo);
                atualizarSelectEdicao(lista);
            }
        }

        function atualizarSelectEdicao(lista) {
            const select = document.getElementById('lista-locais-existentes');
            select.innerHTML = '';
            lista.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.text = item.nome;
                select.appendChild(option);
            });
        }

        function mudarModoEdicao() {
            const id = document.getElementById('seletor-edicao').value;
            if(id === 'novo') {
                document.getElementById('form-dados').reset();
                return;
            }
            const iframe = document.getElementById('map-frame');
            if(iframe && iframe.contentWindow.obterDadosPorId) {
                const dados = iframe.contentWindow.obterDadosPorId(id);
                if(dados) preencherCampos(dados);
            }
        }

        function preencherCampos(d) {
             const inputs = document.querySelectorAll('.input-padrao');
             inputs.forEach(input => {
                const chave = input.id.replace('campo-', '');
                if(d[chave]) input.value = d[chave];
            });
            if(d['Latitude']) document.getElementById('campo-Latitude').value = d['Latitude'];
            if(d['Longitude']) document.getElementById('campo-Longitude').value = d['Longitude'];
        }

        function sairModoAdmin() {
            document.getElementById('form-admin-container').style.display = 'none';
            document.getElementById('auth-buttons-container').style.display = 'block';
            document.querySelectorAll('.password-container').forEach(e => e.style.display = 'none');
            document.querySelectorAll('.btn-auth').forEach(e => e.style.display = 'flex');
        }
        // Fun√ß√£o para abrir/fechar o menu de camadas com troca de √≠cone
        function toggleLayerMenu() {
            const menu = document.getElementById('layer-menu');
            const icon = menu.querySelector('.toggle-icon');
            
            menu.classList.toggle('minimized');

            // Se N√ÉO tiver a classe 'minimized', significa que est√° ABERTO
            if (!menu.classList.contains('minimized')) {
                icon.innerHTML = '&#10005;'; // C√≥digo para o X
                // Ou se preferir um X mais simples, use: icon.innerText = 'X';
            } else {
                icon.innerHTML = '&#9660;'; // C√≥digo para o Tri√¢ngulo para baixo (‚ñº)
            }
        }
    </script>
</body>
</html>