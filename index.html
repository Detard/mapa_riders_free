<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Riders Free</title>
    
    <link rel="icon" href="icones/icones_menu/riders_free_flavicon.png" type="image/png">
    <link rel="stylesheet" href="css/layout.css">
</head>
<body>

    <header class="topbar">
        <div class="topbar-left">
            <button id="menu-toggle" class="btn-menu">
                <img src="icones/icones_menu/legenda.svg" alt="Menu">
            </button>
        </div>

        <div class="topbar-right">
            <img src="icones/icones_menu/riders_free.png" alt="Riders Free" class="logo-estado">
        </div>
    </header>

    <div class="main-container">
        
        <div id="sidebar-container" class="sidebar-container closed">
            
            <button id="btn-close-sidebar-mobile" class="btn-close-mobile">√ó</button>

            <aside class="icon-bar">
                <div class="icon-item active" data-target="panel-locais" title="Locais">
                    <img src="icones/icones_menu/helmet.png" alt="Locais">
                </div>
                <div class="icon-item" data-target="panel-adicionar" title="Adicionar Local">
                    <img src="icones/icones_menu/cloud-computing.png" alt="Adicionar">
                </div>
                <div class="icon-item" data-target="panel-legendas" title="Legendas">
                    <img src="icones/icones_menu/legendas.png" alt="Legendas">
                </div>
                <div class="icon-item" data-target="panel-sobre" title="Sobre">
                    <img src="icones/icones_menu/informacao.png" alt="Sobre">
                </div>
            </aside>

            <div class="content-panel">
                
                <div id="panel-locais" class="panel-section active">
                    <h3>Detalhes do Local</h3>
                    <div id="conteudo-detalhes">
                        <p class="placeholder-text">Selecione um ponto tur√≠stico ou rota no mapa para ver as informa√ß√µes aqui.</p>
                    </div>
                </div>

<div id="panel-adicionar" class="panel-section">
    <h3>Gest√£o de Dados</h3>
    <p style="font-size: 13px; color: #666; margin-bottom: 20px;">√Årea restrita para administradores do grupo.</p>
    
    <div id="auth-buttons-container">
        
        <div class="auth-wrapper" id="wrapper-viagens">
            <button class="btn-auth" onclick="iniciarAuth('viagens')">
                <span>Atualizar Viagens Realizadas</span>
                <img src="icones/icones_menu/padlock.png" class="padlock-icon" alt="Trancado">
            </button>
            
            <div class="password-container" style="display: none;">
                <input type="password" id="pass-viagens" class="input-pass" placeholder="Senha..." onkeyup="verificarEnter(event, 'viagens')">
                <button class="btn-ok" onclick="validarSenha('viagens')">‚Üí</button>
            </div>
        </div>

        <div style="height: 15px;"></div> <div class="auth-wrapper" id="wrapper-lugares">
            <button class="btn-auth" onclick="iniciarAuth('lugares')">
                <span>Atualizar Pontos Tur√≠sticos</span>
                <img src="icones/icones_menu/padlock.png" class="padlock-icon" alt="Trancado">
            </button>

            <div class="password-container" style="display: none;">
                <input type="password" id="pass-lugares" class="input-pass" placeholder="Senha..." onkeyup="verificarEnter(event, 'lugares')">
                <button class="btn-ok" onclick="validarSenha('lugares')">‚Üí</button>
            </div>
        </div>

    </div>

    <div id="form-admin-container" style="display: none;">
        
        <div class="form-header-admin">
            <h4 id="titulo-modo">Editando: ...</h4>
            <button onclick="sairModoAdmin()" class="btn-sair">Voltar</button>
        </div>

        <form id="form-dados" onsubmit="event.preventDefault(); salvarDados();">
            
            <div class="filter-group highlight-group">
                <label>O que voc√™ deseja fazer?</label>
                <select id="seletor-edicao" class="input-padrao" onchange="mudarModoEdicao()">
                    <option value="novo">‚ûï Adicionar Novo Local</option>
                    <optgroup label="-- Editar Existente --" id="lista-locais-existentes">
                        </optgroup>
                </select>
            </div>

            <hr style="border: 0; border-top: 1px dashed #ccc; margin: 15px 0;">

            <input type="hidden" id="admin-tipo-atual">

            <div class="filter-group">
                <label>Nome do Local</label>
                <input type="text" id="campo-nome" class="input-padrao" required>
            </div>

            <div class="filter-group">
                <label>Categoria</label>
                <select id="campo-categoria" class="input-padrao" required>
                    <option value="">Selecione...</option>
                    <option value="Viagem Realizada">Viagem do Grupo</option>
                    <option value="Cachoeira">Cachoeira</option>
                    <option value="Barragem">Barragem</option>
                    <option value="Museu">Museu</option>
                    <option value="Parque">Parque/Ecoturismo</option>
                    <option value="Praia">Praia</option>
                    <option value="Ponto Encontro">Ponto de Encontro</option>
                </select>
            </div>

            <div class="filter-group">
                <label>Coordenadas</label>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="campo-lat" class="input-padrao" placeholder="Latitude">
                    <input type="text" id="campo-long" class="input-padrao" placeholder="Longitude">
                </div>
                <small onclick="alert('Fun√ß√£o de clicar no mapa para pegar coordenada ser√° implementada')" style="cursor:pointer; color:#0352AA;">üìç Capturar do Mapa</small>
            </div>

            <div class="filter-group">
                <label>Descri√ß√£o / Obs</label>
                <textarea id="campo-desc" class="input-padrao" rows="3"></textarea>
            </div>

            <div class="filter-group">
                <label>Link da Pasta (Fotos/Drive)</label>
                <input type="url" id="campo-link" class="input-padrao" placeholder="https://...">
            </div>

            <div class="filter-actions">
                <button type="submit" class="btn-aplicar" id="btn-salvar-texto">Salvar Dados</button>
            </div>
        </form>
    </div>
</div>

                <div id="panel-legendas" class="panel-section">
                    <h3>Categorias</h3>

                    <div class="legenda-grupo">
                        <h4>TURISMO & ROTAS</h4>
                        
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/riders_free.svg" alt="Riders Free">
                            <span>Viagens do Grupo</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/cachoerias.svg" alt="Cachoeiras">
                            <span>Cachoeiras</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/barragem.svg" alt="Barragens">
                            <span>Barragens</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/praia.svg" alt="Praias">
                            <span>Praias</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/parque.svg" alt="Parques">
                            <span>Parques / Ecoturismo</span>
                        </div>
                         <div class="legenda-item">
                            <img src="icones/icones_camadas/serra_da_capivara.svg" alt="Serra da Capivara">
                            <span>Serra da Capivara</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/delta_do_rio_parnaiba.svg" alt="Delta">
                            <span>Delta do Parna√≠ba</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/museu.svg" alt="Museus">
                            <span>Museus</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_camadas/bens_tombados.svg" alt="Bens Tombados">
                            <span>Bens Tombados</span>
                        </div>
                    </div>
                </div>

                <div id="panel-sobre" class="panel-section">
                    <h3>Riders Free Map</h3>
                    <p>O <strong>Mapa Riders Free</strong> √© a ferramenta oficial do grupo para registrar nossas viagens, planejar novos destinos e mapear as belezas naturais do Piau√≠ e arredores.</p>
                    
                    <h4 style="margin-top: 20px; color: #333;">Funcionalidades:</h4>
                    <ul class="lista-sobre">
                        <li><strong>üó∫Ô∏è Rotas:</strong> Hist√≥rico visual de onde o grupo j√° passou.</li>
                        <li><strong>üìç Pontos:</strong> Cachoeiras, barragens e locais para turismo.</li>
                        <li><strong>üèçÔ∏è Planejamento:</strong> Ferramenta para sugerir novos "rol√™s".</li>
                    </ul>

<div class="dev-footer">
    <p>Desenvolvido por:</p>
    <strong>Lucas Mendes</strong>
    
    <a href="https://wa.me/5586995520586" target="_blank" class="btn-whatsapp" title="Fale comigo no WhatsApp"></a>
</div>
                </div>

            </div>
        </div>

        <div id="mobile-overlay" class="mobile-overlay"></div>

        <div class="map-wrapper">
            <iframe src="mapa_riders_free.html" frameborder="0" id="map-frame"></iframe>
            
            <div class="layer-switcher">
                <button id="btn-mapa" class="layer-btn active" onclick="mudarBase('mapa')">Mapa</button>
                <button id="btn-satelite" class="layer-btn" onclick="mudarBase('satelite')">Sat√©lite</button>
            </div>
        </div>
    </div>

    <script>
        const toggleBtn = document.getElementById('menu-toggle');
        const closeBtnMobile = document.getElementById('btn-close-sidebar-mobile');
        const sidebarContainer = document.getElementById('sidebar-container');
        const mobileOverlay = document.getElementById('mobile-overlay');
        const iconItems = document.querySelectorAll('.icon-item');
        const panels = document.querySelectorAll('.panel-section');

        function toggleSidebar() {
            sidebarContainer.classList.toggle('closed');
        }

        function closeSidebar() {
            sidebarContainer.classList.add('closed');
        }

        toggleBtn.addEventListener('click', toggleSidebar);
        mobileOverlay.addEventListener('click', closeSidebar);
        
        if(closeBtnMobile) {
            closeBtnMobile.addEventListener('click', closeSidebar);
        }

        iconItems.forEach(item => {
            item.addEventListener('click', () => {
                iconItems.forEach(i => i.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));

                item.classList.add('active');
                const targetId = item.getAttribute('data-target');
                document.getElementById(targetId).classList.add('active');

                document.querySelector('.content-panel').scrollTop = 0;

                if(sidebarContainer.classList.contains('closed')) {
                    sidebarContainer.classList.remove('closed');
                }
            });
        });

        function mudarBase(tipo) {
            document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + tipo).classList.add('active');

            const iframe = document.getElementById('map-frame');
            if (iframe && iframe.contentWindow && iframe.contentWindow.trocarCamadaBase) {
                iframe.contentWindow.trocarCamadaBase(tipo);
            }
        }
        /* =========================================
   L√ìGICA DE ADMINISTRA√á√ÉO E SENHA
   ========================================= */

const SENHA_MESTRA = "123";

// 1. Troca Bot√£o -> Campo de Senha
function iniciarAuth(tipo) {
    // Esconde o bot√£o normal
    document.querySelector(`#wrapper-${tipo} .btn-auth`).style.display = 'none';
    // Mostra o campo de senha
    const passContainer = document.querySelector(`#wrapper-${tipo} .password-container`);
    passContainer.style.display = 'flex';
    
    // Foca no input automaticamente
    setTimeout(() => {
        document.getElementById(`pass-${tipo}`).focus();
    }, 100);
}

// 2. Cancela e volta ao bot√£o normal
function cancelarAuth(tipo) {
    document.querySelector(`#wrapper-${tipo} .password-container`).style.display = 'none';
    document.querySelector(`#wrapper-${tipo} .btn-auth`).style.display = 'flex';
    document.getElementById(`pass-${tipo}`).value = ''; // Limpa senha
}

// 3. Verifica Enter no input
function verificarEnter(event, tipo) {
    if (event.key === "Enter") {
        validarSenha(tipo);
    }
}

// 4. Valida a Senha e Abre Painel
function validarSenha(tipo) {
    const input = document.getElementById(`pass-${tipo}`);
    
    if (input.value === SENHA_MESTRA) {
        // Sucesso!
        input.value = ''; // Limpa por seguran√ßa
        abrirPainelAdmin(tipo);
    } else {
        // Erro visual
        input.style.borderColor = 'red';
        setTimeout(() => input.style.borderColor = '#1a1a1a', 500);
    }
}

// 5. Configura o Painel para o tipo escolhido
function abrirPainelAdmin(tipo) {
    // Esconde a tela de bot√µes
    document.getElementById('auth-buttons-container').style.display = 'none';
    // Mostra o formul√°rio
    document.getElementById('form-admin-container').style.display = 'block';
    
    // Define contexto
    document.getElementById('admin-tipo-atual').value = tipo;
    
    const titulo = tipo === 'viagens' ? 'Gerenciar Viagens' : 'Gerenciar Pontos Tur√≠sticos';
    document.getElementById('titulo-modo').innerText = titulo;

    // Carrega a lista de itens existentes para edi√ß√£o
    carregarOpcoesEdicao(tipo);
}

// 6. Sair do Painel
function sairModoAdmin() {
    document.getElementById('form-admin-container').style.display = 'none';
    document.getElementById('auth-buttons-container').style.display = 'block';
    
    // Reseta estados dos bot√µes
    cancelarAuth('viagens');
    cancelarAuth('lugares');
}

// 7. L√≥gica de "Carregar Dados para Editar"
function carregarOpcoesEdicao(tipo) {
    const select = document.getElementById('lista-locais-existentes');
    select.innerHTML = ''; // Limpa anteriores

    // Acessa os dados globais do mapa (definidos no script.js como window.dadosLocais)
    // Filtra baseado no tipo de bot√£o clicado
    
    if (window.dadosLocais) {
        const ids = Object.keys(window.dadosLocais);
        
        ids.forEach(id => {
            const item = window.dadosLocais[id];
            
            // Filtro L√≥gico simples:
            // Se clicou em "Viagens", mostra s√≥ o que for "Viagem Realizada" (ou similar)
            // Se clicou em "Lugares", mostra o resto.
            
            // Nota: Isso depende de como os dados est√£o vindo do GeoJSON. 
            // Vou assumir uma verifica√ß√£o baseada na categoria/tipo que definimos no script.js
            
            let deveMostrar = false;
            if (tipo === 'viagens' && item.tipoCategoria === 'Viagem do Grupo') {
                deveMostrar = true; // Ajuste conforme o nome exato da categoria no JS
            } else if (tipo === 'lugares' && item.tipoCategoria !== 'Viagem do Grupo') {
                deveMostrar = true;
            }

            // Se n√£o tivermos certeza da categoria ainda, mostra tudo por enquanto:
            // deveMostrar = true; // (Descomente para testar se n√£o aparecer nada)

            if (deveMostrar) {
                const option = document.createElement('option');
                option.value = id; // O ID √∫nico do leaflet
                option.text = item.nome || "Local sem nome";
                select.appendChild(option);
            }
        });
    }
}

// 8. Preencher formul√°rio ao selecionar um item
function mudarModoEdicao() {
    const select = document.getElementById('seletor-edicao');
    const idSelecionado = select.value;
    const btnSalvar = document.getElementById('btn-salvar-texto');

    if (idSelecionado === 'novo') {
        // Limpa formul√°rio
        document.getElementById('form-dados').reset();
        document.getElementById('seletor-edicao').value = 'novo'; // Mant√©m selecionado
        btnSalvar.innerText = "Salvar Novo Local";
    } else {
        // Preenche com dados existentes
        const dados = window.dadosLocais[idSelecionado];
        if (dados) {
            document.getElementById('campo-nome').value = dados.nome || '';
            document.getElementById('campo-categoria').value = dados.tipoCategoria || ''; // Precisa bater com os values do select
            document.getElementById('campo-desc').value = dados.descricao || dados.description || '';
            
            // Tenta extrair lat/long se for ponto
            // Nota: GeoJSON guarda Longitude, Latitude. Leaflet usa Lat, Long.
            // Isso √© complexo de pegar reverso do layer agrupado, mas vamos tentar pelo properties se existir
            // ou deixar em branco para o usu√°rio preencher.
            
            btnSalvar.innerText = "Salvar Altera√ß√µes";
        }
    }
}

function salvarDados() {
    alert("Dados capturados! Pr√≥ximo passo: Integra√ß√£o com Google Sheets.");
    // Aqui entrar√° o c√≥digo do `fetch()` para o Google Apps Script
}
    </script>
    
</body>
</html>